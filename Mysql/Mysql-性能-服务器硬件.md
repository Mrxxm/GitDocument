## 性能-服务器硬件

#### 什么影响了性能

* 服务器硬件(CPU、磁盘IO、内存)

* 服务器操作系统

* 数据库存储引擎的选择(插件式存储引擎)[MyISAM：不支持事务，表级锁 InnoDB：事务级存储引擎，完美支持行级锁，事务ACID特性]

* 数据库的参数配置

* 数据库结构设计和SQL语句

#### CPU资源和可用内存大小

如何选择CPU

* 频率和数量[主频：2.5GHz 核心数量：18核36线程]

我们的应用是否是CPU密集型的？

* CPU密集型的应用[计算密集型] (我们要加快sql语句处理数据，需要更好的CPU，而不是更多的CPU)

* 目前的Mysql不支持多CPU对同一个SQL并发处理

我们系统的并发量是如何的？

* 为了提高并发量和吞吐量，我们就需要更多的CPU核数。

* 衡量数据库处理能力的指标(QPS：同时处理SQL的数量)，这里的QPS是每秒钟处理的sql的数量。这里说的并发处理40个sql，可能是在纳秒级的。

* Web类应用：核心数量比频率重要

选择32位还是64位的CPU？

* 64位已经成为默认的选择

64位CPU使用32位的服务器版本

* Mysql是一个单线程的服务

内存的选择

常用的MYSQL存储引擎

```
MyISAM -> 索引 -> 内存
       -> 数据 -> OS
InnoDB -> 索引 -> 内存 
       -> 数据 -> 内存
```

#### 磁盘配置和选择

* 使用传统机器磁盘 
* 使用RAID增强传统机器硬盘的性能
* 使用固态存储SSD和PCIe卡
* 使用网络存储NAS和SAN

使用传统机器磁盘

* 最常见
* 价格低
* 使用最多
* 读、写较慢
* 存储空间大

传统机器硬盘的读取过程

* 移动磁头到磁盘表面上的正确位置[访问速度]
* 等待磁盘旋转，使得所需的数据在磁头之下[访问速度]
* 等待磁盘旋转过去，所有所需的数据都被磁头读取[传输速度]

如何选择传统机器磁盘

* 存储容量
* 传输速度
* 访问时间
* 主轴转速[常见：7200 ~ 15000转]
* 物理尺寸

#### 使用RAID增加传统机器硬盘的性能

什么是RAID

* RAID 磁盘冗余队列简称(多个小的磁盘，组合成一个容量巨大的磁盘组，并提供数据冗余来保证数据完整性的技术)

* RAID 0 最早出现的RAID模式，也称为数据条带
* RAID 1 又称为磁盘镜像，原理就是把一个磁盘的数据镜像到另一个磁盘上，在不影响性能的情况下最大限度的保证系统的可靠性和可修复性
* RAID 5 称为分布式奇偶校验磁盘阵列(通过分布式奇偶校验块把数据分散到多个磁盘上)
* RAID 10 分片镜像 对磁盘先做RAID 1 之后对两组RAID 1的磁盘再做RAID 0 

RAID级别的选择

| 等级 | 特点 | 是否冗余 | 盘数 | 读 | 写 |
| --- | --- | --- | --- | --- | --- |
| RAID 0 | 便宜，快速，危险 | 否 | N | 快 | 快 |
| RAID 1 | 高速读，简单，安全 | 有 | 2 | 快 | 慢 |
| RAID 5 | 安全，成本折中 | 有 | N+1 | 快 | 取决于最慢的盘 |
| RAID 10 | 贵，高速，安全 | 有 | 2N | 快 | 快 |

#### 使用固态存储SSD或PCIe卡

固态存储的特点

* 相比机械磁盘固态磁盘有更好的随机读写性能
* 相比机械磁盘固态磁盘能更好的支持并发
* 相比机械磁盘固态磁盘更容易损坏

SSD(固态硬盘)

* 使用SATA接口，可以替换传统磁盘而不需任何改变
* SATA接口的SSD同样支持RAID技术

PCIe卡(Fusion-IO卡：使用闪存技术的PCIe卡)[会占用一部分的内存和CPU性能]

* 无法使用SATA接口需要独特的驱动和配置
* 价格相对于SSD要贵但是性能比SSD更好

固态存储使用的场景

* 适用于存在大量随机I/O的场景(热数据的大小远远大于内存大小所导致)
* 使用于解决单线程负载的I/O瓶颈(主从服务器如果有一块固态存储不应该放在主服务器上1.主服务器是多线程，从服务器是单线程更适合2.对固态硬盘的损耗主服务器损耗比从服务器上严重)

#### 使用网络存储SAN和NAS

SAN 存储区域网络 NAS 网络附加存储

* 是两种外部存储设备加载到服务器上的方法

* SAN设备通过光纤连接到服务器，设备通过块接口访问，服务器可以将其当做硬盘使用
* SAN可以承受大量顺序读写，随机读写慢，不如本地RAID磁盘

* NAS设备使用网络连接，通过基于文件的协议如NFS或SMB来访问

网络存储适合的场景(网络存储顺序读写上表现良好，随机存储差强人意，数据库存储的瓶颈一般就在随机存储上)

* 数据库备份

网络对性能的影响

* 网络带宽、质量
* 网络接口设备对数据库性能的影响
* 网络性能的限制提现在延迟、带宽(磁盘性能的限制体现在延迟、吞吐量)

建议 

* 对多个网卡进行绑定，增强可用性和带宽
* 尽可能的进行网络隔离

#### 服务器硬件对性能的影响-总结

CPU

* 64位的CPU一定要工作在64位的系统下
* 对于并发比较高的场景CPU的数量比频率重要
* 对于CPU密集型场景[计算密集型]和复杂SQL则频率越高越好

内存

* 选择主板所能使用的最高频率的内存
* 内存的大小对性能很重要，所以尽可能大(足够的内存可以把大量随机IO转变成顺序IO，并对读写进行缓存，把多次写合并成一次写)

IO子系统

* PCIe卡(随机IO) > SSD
* SSD又可以使用在传统的磁盘接口上，使用起来会更加的简单
* SSD相比较传统的磁盘设备成本更高
* 出于成本的考虑，由多个传统磁盘设备组成的RAID阵列
* 使用RAID建议使用RAID 10这个级别
* 而对于网络存储可以用于备份
* PCIe卡 > SSD > RAID 10 > 磁盘 > SAN
