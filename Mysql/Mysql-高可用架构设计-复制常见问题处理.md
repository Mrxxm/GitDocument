## MySQL复制常见问题处理

由于数据损坏或者丢失所引起的主从复制错误 (突然宕机，非正常关机引起的)

* 主库或从库意外宕机引起的错误 (当主库的`sync_binlog`参数没有设置为1时，在主库崩溃时，最后几个二进制事件未刷新到磁盘中，当主库重新启动后，从库重新连接读取二进制事件，主库告知从库在主库的二进制日志中并没有二进制偏移量所代表的事件，因为在主库宕机时未把事件记录到二进制日志中，这时候就会出现从库读取不到主库的二进制日志错误，导致主从链路中断) (从库的意外宕机会引起，引起`master_info`文件,没有及时的同步到磁盘上，在`master_info`文件中记录着从库已经同步了主库的二进制日志的相关信息，这可能就会引起从库从主库重复获取部分的二进制日志，这在基于日志点的复制下会出现主从冲突，如果是基于sql段，还会造成一些数据的更新)
* 解决：使用跳过二进制日志事件，注入空事务的方式先恢复中断的复制链路，再使用其他方法对比主从服务器上的数据

---

* 主库上的二进制日志损坏 (主库每次重启后都会重新生成一个二进制日志文件，前一个老的二进制文件可能会因为意外的关闭而被破坏)
* 解决：通过`change master`命令来重新指定 (这样会丢失主库上的一些更新，使得主从数据不一致。需要对丢失的数据进行修复，修复后还要对主从数据进行检验)

---

* 备库上的中继日志损坏 (只要主库二进制日志没有删除，中继日志就很好恢复)
* 解决：通过`change master`命令来重新指定

---

在从库上进行数据修改造成的主从复制错误 (要对从库设置`read_only`参数,使从库只读)

在多个从服务器上存在不唯一的`server_id`或`server_uuid`

* `server_uuid`是记录在数据目录中的auto.cnf文件中 (这个文件一旦存在mysql是不会重新生成这个文件，如果不注意会造成多个从服务器数据库使用同一个`server_uuid`的问题，造成从库丢失二进制日志文件或重复执行二进制日志文件)

`max_allow_packet`设置引起的主从复制错误

#### Mysql复制无法解决的问题

* 分担主数据库的写负载 (只能通过分库分表解决)
* 自动进行故障转移及主从切换


