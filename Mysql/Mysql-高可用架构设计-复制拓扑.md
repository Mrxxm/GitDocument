## MySQL复制拓扑

Mysql5.7之前一个从库只能有一个主库

Mysql5.7之后支持一从多主架构

#### 一主多从的复制拓扑

优点：

* 配置简单
* 可以用多个从库分担读负载

用途：

* 为不同的业务使用不同的从库
* 将一台从库放到远程IDC，用作灾备恢复
* 分担主库的读负载

#### 主-主复制拓扑

主备模式的主主复制 (一台服务器对外提供服务)

主主模式的主主复制 (两台服务器对外提供服务)

主备模式下的主-主复制的配置注意事项 (比主主模式更为常用)

* 只有一台主服务器对外提供服务
* 一台服务器处于只读状态并且只作为热备使用
* 只有在对外提供的主服务器出现故障或是计划性的维护时才会进行切换
* 使原来的备库成为主库，而原来的主库会成为新的备库并处理只读或是下线状态，待维护完成后重新上线
* 确保两台服务器上的初始数据相同
* 确保两台服务器上已经启动binlog并且有不同的server-id
* 在两台服务器上启动log_slave_updates参数
* 在初始的备库上启用read_only

主主模式下的主-主复制的配置注意事项 (并不是一种很好的拓扑结构)

* 产生数据冲突而造成复制链路的中断 (耗费大量的时间，造成数据的丢失)
* 两个主中所操作的表最好能够分开 (尽量的避免数据的冲突)
* 使用下面两个参数控制自增ID的生成
* `auto_increment_increment = 2` (控制自增ID列的步长，默认值为1，指的是一次增加多少值)
* `auto_increment_offset = 1 | 2` (决定自增ID从哪个值开始，默认从1开始自增。一台服务器中设为1，一台服务器中设为2)

拥有备库的主-主复制拓扑

级联复制拓扑


